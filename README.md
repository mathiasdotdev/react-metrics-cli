# React-Metrics CLI

![React-Metrics CLI Screenshot](./assets/react-metrics.png)

**React-Metrics CLI** est une interface en ligne de commande TypeScript pour analyser le code mort dans les projets React/TypeScript. Il utilise le projet [react-metrics](https://github.com/mathias-hadrien/react-metrics.git) (binaire Go) pour l'analyse de code mort et t√©l√©charge automatiquement les binaires depuis Nexus Repository.

## üìã Table des mati√®res

- [üöÄ Installation et d√©marrage rapide](#-installation-et-d√©marrage-rapide)
- [üìñ Utilisation](#-utilisation)
- [‚öôÔ∏è Configuration](#Ô∏è-configuration)
- [üîê Authentification s√©curis√©e](#-authentification-s√©curis√©e)
- [‚ú® Fonctionnalit√©s](#-fonctionnalit√©s)
- [üîß D√©veloppement](#-d√©veloppement)
- [üîó Int√©gration CI/CD](#-int√©gration-cicd)
- [üö® D√©pannage](#-d√©pannage)
- [üìù Diagnostic](#-diagnostic)
- [ü§ù Contribution](#-contribution)
- [üìÑ Licence](#-license)

## üöÄ Installation et d√©marrage rapide

### Installation

```bash
npm install -g react-metrics-cli@latest
```

### Premier lancement

```bash
# Analyse locale (aucune configuration requise si un binaire local est disponible)
# Sinon, voir la section "Configuration optionnelle"
react-metrics analyze

# Ou analyser un projet sp√©cifique
react-metrics analyze ./mon-projet-react
```

### Configuration optionnelle

```bash
# Voir l'√©tat de la configuration actuelle et son emplacement
react-metrics config

# Initialiser le fichier de configuration avec les valeurs par d√©faut
react-metrics config --init

# Vous pouvez aussi configurer vos credentials Nexus avec la commande :
react-metrics config --credentials
```

> Pour copier le **User Token** de Nexus, allez dans [Nexus User Token](https://nexus.maif.io/#user/usertoken), puis copier le token en base64 (format user:password)

### üì¶ Binaires disponibles

Les binaires Go sont automatiquement t√©l√©charg√©s depuis **Nexus Repository Manager** : [react-metrics-artefacts](https://nexus.maif.io/service/rest/repository/browse/react-metrics-artefacts/com/maif/react-metrics/)

#### T√©l√©chargement manuel d'une version sp√©cifique

```bash
# T√©l√©charger une version particuli√®re depuis Nexus
react-metrics download -g com.maif.react-metrics -r react-metrics-artefacts -v 1.2.0

# Sp√©cifier un binaire sp√©cifique par plateforme (la plateforme est d√©tect√©e automatiquement en fonction de votre syst√®me d'exploitation)
react-metrics download -g com.maif.react-metrics -a react-metrics-windows-amd64-1.2.0 -r react-metrics-artefacts -v 1.2.0
```

| Param√®tre           | Description                                 | Exemple                                                    |
| ------------------- | ------------------------------------------- | ---------------------------------------------------------- |
| `-g, --group-id`    | Group ID Maven                              | `com.maif.react-metrics`                                   |
| `-r, --repository`  | Repository Nexus                            | `react-metrics-artefacts`                                  |
| `-f, --format`      | Format de l'artefact                        | `maven2`                                                   |
| `-a, --artifact-id` | Artifact ID (avec plateforme si sp√©cifique) | `react-metrics` ou `react-metrics-windows-amd64-{version}` |
| `-v, --version`     | Version du binaire                          | `1.2.0`                                                    |

## üìñ Utilisation

### Commandes disponibles

#### Analyse de code mort

```bash
# Analyser le r√©pertoire courant
react-metrics analyze

# Analyser un projet sp√©cifique
react-metrics analyze ./mon-projet-react

# Mode debug avec logs d√©taill√©s
react-metrics analyze --debug ./mon-projet-react
```

#### Couverture de tests

```bash
# Analyser la couverture
react-metrics coverage

# G√©n√©rer rapport HTML
react-metrics coverage --html output/coverage/coverage.html
```

#### Configuration

```bash
# Afficher l'emplacement et l'aide
react-metrics config

# Voir la configuration actuelle
react-metrics config --info

# Cr√©er/r√©initialiser la configuration
react-metrics config --init
```

#### Upload vers Nexus

```bash
# Upload des binaires (mode dry-run par d√©faut)
react-metrics upload -v 1.0.0

# Upload r√©el vers Nexus
react-metrics upload -v 1.0.0 --no-dry-run
```

| Option             | Description                                   |
| ------------------ | --------------------------------------------- |
| `-v, --version`    | Version des binaires √† uploader (obligatoire) |
| `-r, --repository` | Repository Nexus cible                        |
| `--dry-run`        | Simulation uniquement (par d√©faut)            |
| `--no-dry-run`     | Upload r√©el vers Nexus                        |

#### Aide contextuelle

```bash
# Aide g√©n√©rale avec diagnostic syst√®me
react-metrics

# Aide d'une commande sp√©cifique
react-metrics analyze --help
```

## ‚öôÔ∏è Configuration

### Fichier de configuration global

**Emplacement :** `$HOME/.nexus-utils/react-metrics.json`

Le fichier permet de personnaliser :

- Extensions de fichiers √† analyser
- Dossiers ignor√©s (standards + personnalis√©s)
- Types d'analyses activ√©es
- Formats de rapports (terminal, HTML, JSON)
- Performances (nombre de goroutines)
- Annotations `// react-metrics-ignore`

**Usage :** Modifiez directement le fichier dans votre √©diteur. Utilisez `react-metrics config` pour voir l'emplacement.

### Emplacements des fichiers

```bash
~/.nexus-utils/                     # R√©pertoire principal de configuration
‚îú‚îÄ‚îÄ react-metrics.json              # Configuration de l'outil (extensions, analyses, rapports)
‚îú‚îÄ‚îÄ .credentials                     # Tokens Nexus chiffr√©s avec AES
‚îú‚îÄ‚îÄ artifacts/                       # Binaires t√©l√©charg√©s depuis Nexus
‚îî‚îÄ‚îÄ cache/                          # Fichiers temporaires et cache
    ‚îú‚îÄ‚îÄ download-cache/
    ‚îî‚îÄ‚îÄ temp-files/
```

## üîê Authentification s√©curis√©e

### Configuration simplifi√©e des credentials

React-Metrics CLI utilise un syst√®me d'authentification s√©curis√© simplifi√© :

**üìù √âtape 1** : R√©cup√©rez votre token depuis Nexus

- Connectez-vous √† Nexus Repository
- Allez dans **User Token**
- Copiez le token base64 (format `user:password` encod√©)

**üîí √âtape 2** : Configuration automatique

```bash
# Premier lancement - les credentials seront demand√©s automatiquement
react-metrics analyze

# Ou configuration explicite
react-metrics config --credentials
```

**üõ°Ô∏è S√©curit√©**

- Token chiffr√© avec AES et mot de passe ma√Ætre
- Stockage s√©curis√© dans `~/.nexus-utils/.credentials`
- Syst√®me de retry intelligent (3 tentatives)
- R√©g√©n√©ration automatique en cas d'√©checs r√©p√©t√©s

### Variables d'environnement

Personnalisez la configuration avec un fichier `.env` :

```bash
# Copiez .env.example vers .env et personnalisez les valeurs
cp .env.example .env
```

Voir `.env.example` pour la liste compl√®te des variables disponibles.

## ‚ú® Fonctionnalit√©s

### Configuration React-Metrics

La CLI g√®re un fichier de configuration global dans `$HOME/.nexus-utils/react-metrics.json` qui permet de personnaliser :

- **Extensions de fichiers** √† analyser (`.js`, `.jsx`, `.ts`, `.tsx`)
- **Dossiers ignor√©s** (standards + personnalis√©s)
- **Types d'analyses** (constantes, fonctions, classes, props, consoles, imports, d√©pendances)
- **Rapports** (terminal, HTML, JSON)
- **Performances** (nombre de goroutines)
- **Annotations** (ignorer les commentaires `// react-metrics-ignore`)

**Configuration simplifi√©e** : Utilisez `react-metrics config` pour voir le chemin du fichier et le modifier directement dans votre √©diteur.

### Types de code mort d√©tect√©s

La CLI utilise le binaire Go pour d√©tecter :

- **Constantes non utilis√©es** : `const UNUSED_CONSTANT = "valeur"`
- **Fonctions non utilis√©es** : Fonctions classiques et fl√©ch√©es
- **Classes non utilis√©es** : `class UnusedClass {}`
- **Appels console** : `console.log`, `console.warn`, etc.
- **Props React non utilis√©es** : Props destructur√©es non utilis√©es

### Exemple de sortie

```bash
üöÄ React-Metrics - Analyse de code mort

‚úÖ Binaire trouv√©
üîç Analyse du projet: /mon-projet-react

=== Constantes ===
Fichier: ../src/components/Button.tsx:16:1
       Nom: UNUSED_CONSTANT

=== Fonctions ===
Fichier: ../src/utils/helpers.ts:10:1
       Nom: unusedFunction

Total: 2 √©l√©ments de code mort d√©tect√©s

‚úÖ Analyse termin√©e avec succ√®s en 1250ms
üìù Logs debug disponibles dans: output/logs/react-metrics-debug.log
```

## üîß D√©veloppement

### Pr√©requis

- Node.js 22.14.0+
- npm ou yarn

### Installation des d√©pendances

```bash
npm install
```

### Scripts disponibles

```bash
# Compilation TypeScript
npm run build

# Build optimis√© pour la production
npm run build:prod

# Analyse de la taille du bundle
npm run build:analyze

# Nettoyage du r√©pertoire dist
npm run clean

# D√©veloppement avec rechargement automatique
npm run dev

# Tests unitaires et d'int√©gration (Vitest)
npm run test

# Tests en mode watch
npm run test:watch

# Tests avec coverage
npm run test:coverage

# Interface web pour les tests
npm run test:ui

# Tests d'int√©gration CLI uniquement
npm run test:integration

# Tests unitaires uniquement
npm run test:unit

# D√©marrage de la CLI compil√©e
npm start
```

### ‚ö†Ô∏è Note importante sur les versions

Lors de l'incr√©mentation de version, pensez √† mettre √† jour **3 fichiers** :

- `package.json` - Version principale
- `CHANGELOG.md` - Nouvelle entr√©e avec les modifications
- `src/__tests__/integration/cli-basic.test.ts` - Test d'expectation de version (le test s'appelle `should display version when --version flag is used`)

### Architecture modulaire

```bash
react-metrics-cli/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ commands/                   # Commandes CLI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Analyze.ts                  # Commande d'analyse de code mort
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Config.ts                   # Gestion de la configuration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Coverage.ts                 # Analyse de couverture de tests
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Download.ts                 # T√©l√©chargement d'artefacts Nexus
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Upload.ts                   # Upload vers Nexus
‚îÇ   ‚îú‚îÄ‚îÄ core/                       # Logique m√©tier
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ binary/                     # Gestion des binaires Go
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BinaryExecutor.ts           # Ex√©cution des binaires
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ BinaryManager.ts            # T√©l√©chargement et gestion
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/                     # Configuration syst√®me
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ConfigManager.ts            # Gestionnaire de configuration
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ System.ts                   # Constantes syst√®me
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ nexus/                      # Authentification Nexus
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ TokenManager.ts             # Gestion des tokens chiffr√©s
‚îÇ   ‚îú‚îÄ‚îÄ ui/                         # Interface utilisateur
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ display/                    # Affichage console
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ HelpDisplay.ts              # Aide contextuelle
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ LogoDisplay.ts              # Logo et branding
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logger/                     # Syst√®me de logging
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Logger.ts                   # Logger centralis√©
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ wrapper/                    # Wrappers Commander.js
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ CommandWrapper.ts           # Wrapper des commandes
‚îÇ   ‚îú‚îÄ‚îÄ system/                     # Diagnostics syst√®me
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SystemDiagnostic.ts         # Diagnostic de l'environnement
‚îÇ   ‚îî‚îÄ‚îÄ index.ts                    # Point d'entr√©e CLI
‚îú‚îÄ‚îÄ scripts/                        # Scripts d'optimisation
‚îú‚îÄ‚îÄ dist/                           # Code TypeScript compil√©
‚îú‚îÄ‚îÄ output/                         # Sortie des analyses et logs
‚îú‚îÄ‚îÄ assets/                         # Ressources (images, etc.)
‚îú‚îÄ‚îÄ package.json                    # Configuration npm
‚îú‚îÄ‚îÄ tsconfig.prod.json              # Configuration TypeScript production
‚îî‚îÄ‚îÄ vitest.config.ts                # Configuration des tests
```

## üîó Int√©gration CI/CD

**Jenkins**

```groovy
pipeline {
    agent any
    stages {
        stage('Analyse Code Mort') {
            steps {
                sh 'npx react-metrics-cli@latest analyze .'
            }
        }
    }
}
```

**GitHub Actions**

```yaml
- name: Analyse du code mort
  run: |
    npm install -g react-metrics-cli@latest
    react-metrics analyze .
```

## üö® D√©pannage

### Erreurs courantes

| Erreur                        | Solution                                |
| ----------------------------- | --------------------------------------- |
| **Token invalide**            | Supprimer `~/.nexus-utils/.credentials` |
| **Binaire non trouv√©**        | V√©rifier permissions Nexus              |
| **T√©l√©chargement impossible** | V√©rifier connexion/permissions          |
| **Permissions insuffisantes** | `chmod +x` sur le binaire               |

### üìù Diagnostic

```bash
# Mode debug
react-metrics analyze --debug

# Info configuration
react-metrics config --info
```

## ü§ù Contribution

Consultez [CONTRIBUTING.md](CONTRIBUTING.md) pour contribuer au projet.

## üìÑ License

MIT License - voir [LICENSE](LICENSE) pour plus de d√©tails.
